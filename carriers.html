<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8">
  <title>–ë–æ–ª–æ–º–∂–∏—Ç —Ö“Ø—Ä–≥—ç–≥—á–∏–¥</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header>–ë–æ–ª–æ–º–∂–∏—Ç —Ö“Ø—Ä–≥—ç–≥—á–∏–¥</header>

<div class="container" id="list"></div>

<a href="index.html" class="back-link">‚Üê –ë—É—Ü–∞—Ö</a>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, onValue, get, update, remove } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyD_2GnarpqIcFj6e6Qop5fxOljjbhuDOy0",
  authDomain: "huwsgulhurgelt.firebaseapp.com",
  databaseURL: "https://huwsgulhurgelt-default-rtdb.firebaseio.com/",
  projectId: "huwsgulhurgelt",
  storageBucket: "huwsgulhurgelt.firebasestorage.app",
  messagingSenderId: "274801313992",
  appId: "1:274801313992:web:1449e8135030e0c6ba7dfd",
  measurementId: "G-WLFV2M24LC"
};

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

const list = document.getElementById('list');
const carriersRef = ref(database,'carriers');

onValue(carriersRef, snapshot => {
  const data = snapshot.val();
  list.innerHTML = '';
  if(data){
    Object.keys(data).forEach(key=>{
      const c = data[key];
      const div = document.createElement('div');
      div.className='card';
      div.innerHTML=`
        <p><strong>–£—Ç–∞—Å:</strong> ${c.phone}</p>
        <p><strong>–¢–∞–π–ª–±–∞—Ä:</strong> ${c.description}</p>
        <div class="card-buttons">
          <button onclick="editCarrier('${key}')">‚úèÔ∏è –ó–∞—Å–∞—Ö</button>
          <button onclick="deleteCarrier('${key}')">üóëÔ∏è –£—Å—Ç–≥–∞—Ö</button>
        </div>
      `;
      list.appendChild(div);
    });
  } else {
    list.innerHTML="<p class='empty'>–•–æ–æ—Å–æ–Ω –±–∞–π–Ω–∞</p>";
  }
});

window.deleteCarrier = function(id){
  const pin = prompt("–ù—É—É—Ü PIN –æ—Ä—É—É–ª–Ω–∞ —É—É:");
  get(ref(database,'carriers/'+id)).then(snap=>{
    if(snap.val().pin===pin){ remove(ref(database,'carriers/'+id)); }
    else alert("PIN –±—É—Ä—É—É –±–∞–π–Ω–∞");
  });
};

window.editCarrier = function(id){
  const pin = prompt("–ù—É—É—Ü PIN –æ—Ä—É—É–ª–Ω–∞ —É—É:");
  get(ref(database,'carriers/'+id)).then(snap=>{
    const data = snap.val();
    if(data.pin===pin){
      const newPhone = prompt("–®–∏–Ω—ç —É—Ç–∞—Å:", data.phone);
      const newDesc = prompt("–®–∏–Ω—ç —Ç–∞–π–ª–±–∞—Ä:", data.description);
      update(ref(database,'carriers/'+id), { phone: newPhone||data.phone, description: newDesc||data.description });
    } else alert("PIN –±—É—Ä—É—É –±–∞–π–Ω–∞");
  });
};
</script>
</body>
</html>
