<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8">
  <title>Боломжит хүргэгчид</title>
  <style>
    body { font-family: Arial; background:#f9f9f9; padding:40px; }
    .card { background:white; padding:30px; margin:30px auto; max-width:800px;
            border-radius:16px; box-shadow:0 4px 10px rgba(0,0,0,.1); }
    button { margin-right:20px; padding:8px 24px; font-size:32px; }
    a { display:block; text-align:center; margin-top:30px; color:#2196F3; text-decoration:none; }
  </style>
</head>
<body>

<h1 style="text-align:center;">Боломжит хүргэгчид</h1>
<div id="list"></div>
<a href="index.html">← Буцах</a>

<script>
let carriers = JSON.parse(localStorage.getItem("carriers")) || [];
const list = document.getElementById("list");

// Migrate old posts without PIN
carriers = carriers.map(c => {
  if (!c.pin) c.pin = "0000"; // old posts get default PIN
  return c;
});
localStorage.setItem("carriers", JSON.stringify(carriers));

function render() {
  list.innerHTML = "";
  if (carriers.length === 0) {
    list.innerHTML = "<p style='text-align:center;color:gray;'>Хоосон байна</p>";
    return;
  }

  carriers.forEach((c, index) => {
    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <p><strong>Утас:</strong> ${c.phone}</p>
      <p><strong>Тайлбар:</strong> ${c.description}</p>
      <button onclick="editCarrier(${index})"> Засах</button>
      <button onclick="deleteCarrier(${index})"> Устгах</button>
    `;
    list.appendChild(div);
  });
}

function deleteCarrier(index) {
  const pin = prompt("Нууц PIN оруулна уу:");
  if (!pin) return;

  if (carriers[index].pin === pin) {
    carriers.splice(index,1);
    localStorage.setItem("carriers", JSON.stringify(carriers));
    render();
  } else {
    alert("PIN буруу байна");
  }
}

function editCarrier(index) {
  const pin = prompt("Нууц PIN оруулна уу:");
  if (!pin) return;

  if (carriers[index].pin === pin) {
    const newPhone = prompt("Шинэ утас:", carriers[index].phone);
    const newDesc = prompt("Шинэ тайлбар:", carriers[index].description);

    if (newPhone) carriers[index].phone = newPhone;
    if (newDesc) carriers[index].description = newDesc;

    localStorage.setItem("carriers", JSON.stringify(carriers));
    render();
  } else {
    alert("PIN буруу байна");
  }
}

render();
</script>

</body>
</html>
